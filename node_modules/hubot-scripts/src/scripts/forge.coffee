# Description:
#   Test
#
# Commands:
#   forgebot say hi - Says "Hiiii!!!!!"
#		
# 
module.exports = (robot) ->

	robot.respond /say hi$/i, (msg) ->
		msg.send "Hiiii!!!!!"
		
	# When puppetlabs publishes a module on forge...
	robot.router.post '/forgebot/puppet-modules/new', (req, res) ->
		mod_name = req.body.name
		msg = "puppetlabs published module <a href=\"http://forge.puppetlabs.com/puppetlabs/#{mod_name}\">#{mod_name}</a>"
		for param_name,value of req.body.properties
			msg += "\n#{param_name} = #{value}"
		
		robot.messageRoom "Shell", msg
		res.writeHead 204, { 'Content-Length': 0 }
		res.end()
	
	# When puppetlabs edits a module on forge...	
	robot.router.post '/forgebot/puppet-modules/edit', (req, res) ->
		mod_name = req.body.name
		msg = "puppetlabs edited module #{mod_name}"		
		for param_name,change of req.body.changes
			msg += "\nChanged #{param_name} from #{change.old} to #{change.new}"
		
		robot.messageRoom "Shell", msg
		res.writeHead 204, { 'Content-Length': 0 }
		res.end()
	
	# When puppetlabs publishes a new release of a module on forge...	
	robot.router.post '/forgebot/puppet-modules/releases/new', (req, res) ->
		mod_name = req.body.name
		version = req.body.version
		robot.messageRoom "Shell", "puppetlabs released <a href=\"http://forge.puppetlabs.com/puppetlabs/#{mod_name}/#{version}\">#{mod_name} #{version}</a> on forge"
		res.writeHead 204, { 'Content-Length': 0 }
		res.end()
		
	